<!DOCTYPE html>
<html>
	<head>
	  <meta charset="utf-8">
	  <title>Engine Example</title>
	</head>
	<body>
	  <script src="js/EventDispatcher.js"></script>
	  <script src="js/Surface.js"></script>
	  <script src="js/Core.js"></script>
	  <script src="js/DisplayObject.js"></script>
	  <script src="js/Scene.js"></script>
	  <script src="js/Sprite.js"></script>
	  <script src="js/CoreException.js"></script>
	  <script src="js/SceneException.js"></script>
	  <script src="js/Keyboard.js"></script>
	  <script src="js/Render.js"></script>
	  <script src="js/Tween.js"></script>
	  <script src="js/TweenGroup.js"></script>
	  <script src="js/CollisionManager.js"></script>
	  <script src="js/TextField.js"></script>
	  <script type="text/javascript">
	  	var game = new Core(300, 300, 30);
	  	game.preloadAsset('img/wizard_evil_no_bg.png');
	  	game.preloadAsset('img/knife.png');
	  	game.preloadAsset('img/bg.png');
	  	game.addEventListener('load', function(e) {
	  		var wiz = new Sprite(16,16);
	  		wiz.y = 300 - wiz.height;
			wiz.image = game.assets['img/wizard_evil_no_bg.png'];
	  		game.rootScene.addChild(wiz);

	  		var wizs = [];
	  		for (var x = 0; x < 8; x++) {
	  			for (var y = 0; y < 3; y++) {
	  				var wiz2 = new Sprite(16,16);
	  				wiz2.image = game.assets['img/wizard_evil_no_bg.png'];
	  				wiz2.x = 18 * x + 80;
	  				wiz2.y = 18 * y + 10
	  				game.rootScene.addChild(wiz2);
		  			wiz2.tweenGroup.moveTo(wiz2.x + 50, wiz2.y, 30).moveTo(wiz2.x - 50, wiz2.y, 30).setLoop(true);
		  			wizs.push(wiz2);
	  			}
	  		}

	  		var bg = new Sprite(550, 400);
	  		bg.image = game.assets['img/bg.png'];
	  		game.rootScene.addChild(bg);
	  		game.rootScene.setChildIndex(bg, 0);

	  		var scoreLabel = new TextField('score: 0', 'Arial', 12, 'black', 'left');
	  		scoreLabel.x = 10;
	  		scoreLabel.y = 20;
	  		var score = 0;
	  		game.rootScene.addChild(scoreLabel);

	  		var bullets = [];

	  		game.addEventListener('enterframe', function(e) {
	  			for (var i = 0; i < bullets.length; i++) {
	  				var bullet = bullets[i];
	  				if (bullet.y < -10) {
	  					game.rootScene.removeChildAt(game.rootScene.childs.indexOf(bullet));
	  					bullets.splice(bullets.indexOf(bullet), 1);
	  				}
	  				if (!bullet.visible) continue;
	  				bullet.y -= 8;
	  				for (var j = 0; j < wizs.length; j++) {
	  					var wiz2 = wizs[j];
	  					if (bullet.boxCollides(wiz2, false)) {
			  				console.log('colidiu');
			  				wizs.splice(wizs.indexOf(wiz2), 1);
			  				game.rootScene.removeChildAt(game.rootScene.childs.indexOf(wiz2));
			  				bullets.splice(bullets.indexOf(bullet), 1);
			  				game.rootScene.removeChildAt(game.rootScene.childs.indexOf(bullet));
			  				score += 1;
			  				scoreLabel.text = 'score: ' + score;
			  				if (score == 24) {
			  					var scene = new Scene('End game');
			  					scene.addChild(scoreLabel);
			  					scoreLabel.fontSize = 30;
			  					scoreLabel.x = 80;
			  					scoreLabel.y = 150;
			  					game.addScene(scene);
			  					game.changeScene('End game');
			  				}
			  				break;
		  				}
	  				}
	  			}
	  		});

	  		game.addEventListener('keydown', function(e) {
	  			if(Keyboard.pressedKeys[Keyboard.KEY_CODES['Right']]) {
	  				wiz.x += 5;
	  			}

	  			if(Keyboard.pressedKeys[Keyboard.KEY_CODES['Left']]) {
	  				wiz.x -= 5;
	  			}

	  			if(Keyboard.pressedKeys[Keyboard.KEY_CODES['Space']]) {
	  				var knife = new Sprite(16, 16);
	  				knife.image = game.assets['img/knife.png'];
	  				knife.x = wiz.x + wiz.width / 2;
	  				knife.y = wiz.y - 5;
	  				game.rootScene.addChild(knife);
	  				bullets.push(knife);
	  			}
	  		});
	  	});
	  	game.init();
	  </script>
	</body>
</html>